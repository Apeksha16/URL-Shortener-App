<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function URLShortener() {
            const [longUrl, setLongUrl] = useState('');
            const [shortenedUrls, setShortenedUrls] = useState([]);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState('');

            // Load existing URLs from localStorage on component mount
            useEffect(() => {
                const stored = localStorage.getItem('shortenedUrls');
                if (stored) {
                    setShortenedUrls(JSON.parse(stored));
                }

                // Check if current URL is a short URL and redirect
                const currentPath = window.location.pathname;
                if (currentPath.length > 1) {
                    const shortCode = currentPath.substring(1);
                    const stored = localStorage.getItem('shortenedUrls');
                    if (stored) {
                        const urls = JSON.parse(stored);
                        const foundUrl = urls.find(url => url.shortCode === shortCode);
                        if (foundUrl) {
                            window.location.href = foundUrl.originalUrl;
                            return;
                        }
                    }
                }
            }, []);

            const generateShortCode = () => {
                const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let result = '';
                for (let i = 0; i < 6; i++) {
                    result += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return result;
            };

            const isValidUrl = (string) => {
                try {
                    new URL(string);
                    return true;
                } catch (_) {
                    return false;
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setError('');
                
                if (!longUrl.trim()) {
                    setError('Please enter a URL');
                    return;
                }

                if (!isValidUrl(longUrl)) {
                    setError('Please enter a valid URL (include http:// or https://)');
                    return;
                }

                setIsLoading(true);

                // Simulate API delay
                setTimeout(() => {
                    const shortCode = generateShortCode();
                    const baseUrl = window.location.origin;
                    const shortUrl = `${baseUrl}/${shortCode}`;
                    
                    const newUrlEntry = {
                        id: Date.now(),
                        originalUrl: longUrl,
                        shortCode: shortCode,
                        shortUrl: shortUrl,
                        createdAt: new Date().toISOString(),
                        clicks: 0
                    };

                    const updatedUrls = [newUrlEntry, ...shortenedUrls];
                    setShortenedUrls(updatedUrls);
                    localStorage.setItem('shortenedUrls', JSON.stringify(updatedUrls));
                    
                    setLongUrl('');
                    setIsLoading(false);
                }, 500);
            };

            const copyToClipboard = async (text) => {
                try {
                    await navigator.clipboard.writeText(text);
                    // You could add a toast notification here
                } catch (err) {
                    console.error('Failed to copy: ', err);
                }
            };

            const deleteUrl = (id) => {
                const updatedUrls = shortenedUrls.filter(url => url.id !== id);
                setShortenedUrls(updatedUrls);
                localStorage.setItem('shortenedUrls', JSON.stringify(updatedUrls));
            };

            return (
                <div className="container mx-auto px-4 py-8 max-w-4xl">
                    {/* Header */}
                    <div className="text-center mb-12">
                        <h1 className="text-4xl font-bold text-gray-800 mb-4">
                            🔗 URL Shortener
                        </h1>
                        <p className="text-gray-600 text-lg">
                            Transform long URLs into short, shareable links
                        </p>
                    </div>

                    {/* URL Shortening Form */}
                    <div className="bg-white rounded-2xl shadow-xl p-8 mb-8">
                        <form onSubmit={handleSubmit} className="space-y-6">
                            <div>
                                <label htmlFor="longUrl" className="block text-sm font-medium text-gray-700 mb-2">
                                    Enter your long URL
                                </label>
                                <input
                                    type="text"
                                    id="longUrl"
                                    value={longUrl}
                                    onChange={(e) => setLongUrl(e.target.value)}
                                    placeholder="https://www.example.com/some/very/long/path"
                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                                />
                                {error && (
                                    <p className="mt-2 text-sm text-red-600">{error}</p>
                                )}
                            </div>
                            
                            <button
                                type="submit"
                                disabled={isLoading}
                                className="w-full bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 flex items-center justify-center"
                            >
                                {isLoading ? (
                                    <>
                                        <svg className="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                                            <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                        Shortening...
                                    </>
                                ) : (
                                    'Shorten URL'
                                )}
                            </button>
                        </form>
                    </div>

                    {/* Shortened URLs List */}
                    {shortenedUrls.length > 0 && (
                        <div className="bg-white rounded-2xl shadow-xl p-8">
                            <h2 className="text-2xl font-bold text-gray-800 mb-6">Your Shortened URLs</h2>
                            <div className="space-y-4">
                                {shortenedUrls.map((url) => (
                                    <div key={url.id} className="border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow">
                                        <div className="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
                                            <div className="flex-1 min-w-0">
                                                <div className="mb-2">
                                                    <span className="text-sm font-medium text-gray-500">Original URL:</span>
                                                    <p className="text-gray-800 truncate" title={url.originalUrl}>
                                                        {url.originalUrl}
                                                    </p>
                                                </div>
                                                <div>
                                                    <span className="text-sm font-medium text-gray-500">Short URL:</span>
                                                    <p className="text-blue-600 font-medium">
                                                        {url.shortUrl}
                                                    </p>
                                                </div>
                                                <div className="mt-2 text-xs text-gray-400">
                                                    Created: {new Date(url.createdAt).toLocaleDateString()}
                                                </div>
                                            </div>
                                            
                                            <div className="flex gap-2">
                                                <button
                                                    onClick={() => copyToClipboard(url.shortUrl)}
                                                    className="bg-green-100 hover:bg-green-200 text-green-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                >
                                                    📋 Copy
                                                </button>
                                                <a
                                                    href={url.originalUrl}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="bg-blue-100 hover:bg-blue-200 text-blue-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                >
                                                    🔗 Visit
                                                </a>
                                                <button
                                                    onClick={() => deleteUrl(url.id)}
                                                    className="bg-red-100 hover:bg-red-200 text-red-700 px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                                                >
                                                    🗑️ Delete
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Instructions */}
                    <div className="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 className="text-lg font-semibold text-blue-800 mb-2">How it works:</h3>
                        <ul className="text-blue-700 space-y-1 text-sm">
                            <li>• Enter any long URL in the form above</li>
                            <li>• Get a shortened version that you can share</li>
                            <li>• When someone visits the short URL, they'll be redirected to the original</li>
                            <li>• All your shortened URLs are saved locally in your browser</li>
                        </ul>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<URLShortener />, document.getElementById('root'));
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97dd09d3774aa748',t:'MTc1NzY1NTI5NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
